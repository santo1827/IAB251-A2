@* QUOTATION OFFICER - DASHBOARD *@
@* Page where quoatation officer can view all of the quotations that need to be done and show their status *@
@page "/employee/inbox"
@using interport.Pages.Quotation.Employees;
@model InboxModel
@using System.Globalization
@{
    ViewData["Title"] = "Quotation Inbox";

    var page = 1;
    var pageSize = 10;

    var items = new[]
    {
        new { Id=1001, Customer="Ridgewater Farms", Email="ops@ridgewater.com", Phone="0400 111 222", Source="Toowoomba, QLD", Destination="Port of Brisbane, QLD", Containers=2, ContainerType="20ft", Created=DateTime.Now.AddDays(-5), ReqStatus="New", QuoteStatus="Pending" },
        new { Id=1002, Customer="Sunrise Engineering", Email="logistics@sunrise.com", Phone="0400 333 444", Source="Rockhampton, QLD", Destination="Brisbane, QLD",       Containers=1, ContainerType="40ft", Created=DateTime.Now.AddDays(-2), ReqStatus="In Review", QuoteStatus="Accepted" },
        new { Id=1003, Customer="Green Valley Co",    Email="ops@greenvalley.com",  Phone="0400 555 666", Source="Roma, QLD",       Destination="Port of Brisbane, QLD", Containers=3, ContainerType="40ft HC", Created=DateTime.Now.AddDays(-1), ReqStatus="Quoted", QuoteStatus="Rejected" },
        new { Id=1004, Customer="Lockyer Logistics",  Email="quotes@lockyer.com",   Phone="0400 777 888", Source="Ipswich, QLD",    Destination="Brisbane, QLD",         Containers=1, ContainerType="20ft", Created=DateTime.Now.AddHours(-8), ReqStatus="New", QuoteStatus="Pending" },
        new { Id=1005, Customer="Valley Produce",     Email="sales@valley.com",     Phone="0400 999 000", Source="Gatton, QLD",    Destination="Sydney, NSW",           Containers=2, ContainerType="20ft", Created=DateTime.Now.AddDays(-7), ReqStatus="Closed", QuoteStatus="Accepted" }
    };

    var totalCount = items.Length;
    var totalPages = (int)Math.Ceiling((double)totalCount / pageSize);

    string BadgeForQuoteStatus(string s) =>
        s == "Accepted" ? "success" :
        s == "Rejected" ? "danger" :
        s == "Pending"  ? "warning" : "secondary";

    string BadgeForReqStatus(string s) =>
        s switch { "New" => "primary", "In Review" => "info", "Quoted" => "success", "Closed" => "secondary", _ => "light" };
}
<div class="container-fluid py-4">
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
        <h2 class="mb-0">Quotation Requests</h2>
        <div class="d-flex align-items-center gap-2">
            <span class="badge rounded-pill bg-success">Accepted</span>
            <span class="badge rounded-pill bg-warning text-dark">Pending</span>
            <span class="badge rounded-pill bg-danger">Rejected</span>
        </div>
    </div>

    <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <input name="q" class="form-control" placeholder="Search customer, email, source, destination">
        </div>
        <div class="col-md-2">
            <select name="quoteStatus" class="form-select">
                <option value="">All Quotation Status</option>
                <option>Accepted</option>
                <option>Pending</option>
                <option>Rejected</option>
            </select>
        </div>
        <div class="col-md-2">
            <select name="reqStatus" class="form-select">
                <option value="">All Request Status</option>
                <option>New</option>
                <option>In Review</option>
                <option>Quoted</option>
                <option>Closed</option>
            </select>
        </div>
        <div class="col-md-2">
            <input type="date" name="from" class="form-control">
        </div>
        <div class="col-md-2">
            <input type="date" name="to" class="form-control">
        </div>
        <div class="col-12 d-flex gap-2">
            <button class="btn btn-primary">Filter</button>
            <a class="btn btn-outline-secondary" href="">Reset</a>
        </div>
    </form>

    <div class="d-flex justify-content-end mb-2">
        <div class="btn-group">
            <a class="btn btn-outline-secondary active">Newest</a>
            <a class="btn btn-outline-secondary">Oldest</a>
            <a class="btn btn-outline-secondary">Priority</a>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table align-middle">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Customer</th>
                    <th>Route</th>
                    <th>Equipment</th>
                    <th>Request</th>
                    <th>Quotation</th>
                    <th>Created</th>
                    <th class="text-end"></th>
                </tr>
            </thead>
            <tbody>
            @if (!items.Any())
            {
                <tr><td colspan="8" class="text-center text-muted py-5">No requests</td></tr>
            }
            else
            {
                foreach (var r in items)
                {
                    var qBadge = BadgeForQuoteStatus(r.QuoteStatus);
                    var reqBadge = BadgeForReqStatus(r.ReqStatus);
                    <tr>
                        <td class="fw-semibold">#@r.Id</td>
                        <td>
                            <div class="fw-semibold">@r.Customer</div>
                            <div class="text-muted small">@r.Email • @r.Phone</div>
                        </td>
                        <td>
                            <div>@r.Source</div>
                            <div class="text-muted small">→ @r.Destination</div>
                        </td>
                        <td>@r.Containers x @r.ContainerType</td>
                        <td><span class="badge bg-@reqBadge">@r.ReqStatus</span></td>
                        <td><span class="badge bg-@qBadge">@r.QuoteStatus</span></td>
                        <td>@r.Created.ToString("dd MMM yyyy, HH:mm", CultureInfo.InvariantCulture)</td>
                        <td class="text-end">
                            <div class="btn-group">
                                <a class="btn btn-sm btn-outline-primary" asp-page="/Quotation/RequestDashboard" asp-route-id="@r.Id">Open</a>
                                <a class="btn btn-sm btn-outline-secondary" asp-page="/Quotation/Quotations" asp-route-id="@r.Id">Quotation</a>
                            </div>
                        </td>
                    </tr>
                }
            }
            </tbody>
        </table>
    </div>

    <div class="d-flex justify-content-between align-items-center">
        <div class="text-muted">Page total</div>
        <nav>
            <ul class="pagination mb-0">
                <li class="page-item @(page<=1 ? "disabled" : "")">
                    <a class="page-link" href="#">Prev</a>
                </li>
                <li class="page-item @(page>=totalPages ? "disabled" : "")">
                    <a class="page-link" href="#">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>
